# 测试指南 (Testing Guide)

## 🧪 自动化测试（推荐）

### 快速开始

1. **打开测试页面**
   ```bash
   # 在浏览器中打开
   open test-automation.html
   # 或者双击 test-automation.html 文件
   ```

2. **运行测试**
   - 点击页面中的"▶️ 运行所有测试"按钮
   - 等待 30-60 秒，测试将自动完成
   - 查看测试结果和控制台日志

3. **查看结果**
   - ✅ **绿色**：测试通过
   - ❌ **红色**：测试失败（查看错误详情）
   - ⏭️ **黄色**：测试跳过

### 测试覆盖范围

| Phase | 测试项 | 测试内容 |
|-------|--------|----------|
| **Phase 1** | 2 个测试 | Firebase 配置验证 |
| **Phase 2** | 3 个测试 | Firebase SDK 加载、全局变量、初始化函数 |
| **Phase 3** | 3 个测试 | 认证 UI、认证函数、错误处理 |
| **Phase 4** | 4 个测试 | CRUD 函数、离线队列、数据迁移、自动保存 |
| **UI** | 2 个测试 | UI 元素存在、CSS 样式加载 |
| **总计** | **14 个测试** | 完整 MVP 功能验证 |

### 预期结果

如果所有配置正确：
- ✅ **14/14 测试通过**
- 🎉 弹出成功提示："所有测试都通过了！"

如果有测试失败：
- 查看红色测试项的错误详情
- 参考"常见问题"部分排查

### 导出测试报告

点击"📄 导出报告"按钮，将生成 JSON 格式的测试报告：
```
speckit-test-report-YYYY-MM-DDTHH-mm-ss.json
```

---

## 🖱️ 手动测试（可选）

如果需要验证实际用户体验，可以进行以下手动测试：

### 1. 认证流程测试 (5 分钟)

**测试步骤**:
1. 打开 `index.html` 在浏览器中
2. 应该看到登录/注册界面
3. 点击"注册"标签
4. 输入邮箱和密码（例如：`test@example.com` / `123456`）
5. 点击"注册"按钮

**预期结果**:
- ✅ 显示"注册成功！欢迎加入 Spec Kit"提示
- ✅ 自动登录并显示主应用界面
- ✅ 右上角显示用户邮箱和"登出"按钮

**测试登出**:
1. 点击右上角"登出"按钮
2. 确认登出

**预期结果**:
- ✅ 返回到登录界面
- ✅ 显示"已安全退出"提示

**测试登录**:
1. 输入刚才注册的邮箱和密码
2. 点击"登录"按钮

**预期结果**:
- ✅ 显示"登录成功！"提示
- ✅ 自动进入主应用界面
- ✅ 之前的数据仍然存在

---

### 2. 数据持久化测试 (3 分钟)

**测试步骤**:
1. 确保已登录
2. 点击"➕ 新建项目"按钮
3. 输入项目名称（例如：`测试项目 1`）
4. 点击"创建"按钮
5. 在项目中添加一些数据（输入、备注等）
6. 关闭浏览器标签页
7. 重新打开 `index.html`

**预期结果**:
- ✅ 自动登录（无需重新输入密码）
- ✅ "测试项目 1"仍然存在
- ✅ 所有输入和备注都保存了

---

### 3. 多设备同步测试 (5 分钟)

**测试步骤**:
1. 在第一个浏览器（例如：Chrome）中登录
2. 创建一个新项目（例如：`同步测试`）
3. 在第二个浏览器（例如：Safari）或另一台设备中
4. 打开 `index.html`
5. 使用相同的账号登录

**预期结果**:
- ✅ "同步测试"项目自动出现
- ✅ 在任一浏览器中修改数据
- ✅ 刷新另一个浏览器，修改会同步

---

### 4. 离线模式测试 (3 分钟)

**测试步骤**:
1. 确保已登录
2. 打开浏览器开发者工具（F12）
3. 切换到"Network"标签
4. 勾选"Offline"（离线模式）
5. 右上角连接状态应显示"🔴 离线"
6. 尝试修改项目数据（例如：添加备注）
7. 取消"Offline"勾选（恢复在线）

**预期结果**:
- ✅ 离线时可以继续编辑数据
- ✅ 数据保存到 localStorage
- ✅ 恢复在线后，显示"所有离线更改已同步"提示
- ✅ 刷新页面，离线修改仍然存在

---

### 5. LocalStorage 迁移测试 (可选，3 分钟)

如果之前使用过旧版本（没有 Firebase）：

**测试步骤**:
1. 确保旧版本有数据存储在 localStorage 中
2. 打开新版本 `index.html`
3. 注册/登录账号
4. 应该看到迁移提示："检测到本地存储有 X 个项目。是否迁移到云端？"
5. 点击"确定"

**预期结果**:
- ✅ 显示"成功迁移 X 个项目到云端"
- ✅ 所有旧项目出现在新版本中
- ✅ 提示是否清除本地存储

---

## ❌ 常见问题排查

### 问题 1: 测试失败："Firebase 配置未更新"

**原因**: `index.html` 中的 Firebase 配置仍为占位符

**解决**:
1. 检查 `.env` 文件是否存在且填写正确
2. 检查 `index.html` 中的 `firebaseConfig` 是否已更新
3. 确保 API Key 不是 `YOUR_API_KEY`

---

### 问题 2: 测试失败："Firebase SDK 未加载"

**原因**: 网络问题或 CDN 被屏蔽

**解决**:
1. 检查浏览器控制台是否有网络错误
2. 确保能访问 `https://www.gstatic.com/firebasejs/`
3. 如果 CDN 被屏蔽，考虑使用 VPN 或下载 SDK 到本地

---

### 问题 3: 手动测试时看不到登录界面

**原因**: 可能已经登录（有 session）

**解决**:
1. 打开浏览器开发者工具（F12）
2. 在 Console 中输入：`localStorage.clear()`
3. 刷新页面

---

### 问题 4: 注册时显示"该邮箱已被注册"

**原因**: 之前已注册过该邮箱

**解决**:
1. 使用不同的邮箱
2. 或点击"登录"标签直接登录

---

### 问题 5: 数据没有同步到 Firebase

**原因**: Firebase 配置或安全规则问题

**解决**:
1. 打开浏览器控制台（F12）
2. 查看是否有 Firebase 错误
3. 检查 Firebase Console 中的安全规则是否部署
4. 确认 Realtime Database 已启用

---

## 📊 测试清单

打印此清单并逐项完成：

- [ ] 自动化测试全部通过（14/14）
- [ ] 用户注册成功
- [ ] 用户登录成功
- [ ] 用户登出成功
- [ ] 创建项目成功
- [ ] 项目数据保存并刷新后仍存在
- [ ] 多设备登录同步成功
- [ ] 离线模式编辑成功
- [ ] 离线数据恢复在线后同步成功
- [ ] (可选) LocalStorage 迁移成功

---

## ✅ 测试完成后

如果所有测试通过：
1. 可以继续 **Phase 8: 部署优化**
2. 或继续 **Phase 5-7: UI 增强功能**

如果有测试失败：
1. 参考"常见问题排查"部分
2. 检查 Firebase Console 配置
3. 查看浏览器控制台错误日志

---

## 📞 获取帮助

如果测试遇到问题：
1. 检查 `IMPLEMENTATION_STATUS.md` 中的已知问题
2. 查看浏览器控制台的详细错误信息
3. 导出测试报告并查看失败的具体原因

---

**测试版本**: 1.0
**最后更新**: 2025-10-15
**适用于**: Phase 1-4 (MVP)
