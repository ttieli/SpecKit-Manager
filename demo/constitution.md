您的查询涉及在 AI 辅助的规范驱动开发（Spec-Driven Development, SDD）工作流中，如何编写项目的 **宪法** （Constitution），以明确不可协商的治理原则、代码质量、测试要求和性能目标。

在 GitHub Spec Kit 这样的工具包中，项目宪法是一个 **核心且非协商性的工件** ，它定义了指导 AI 代理（如 Claude Code 或 GitHub Copilot）进行规划和实施的 **架构 DNA** 。宪法冲突会被视为 **严重（CRITICAL）问题** ，必须通过修改规范、计划或任务来解决，原则本身不可稀释或忽略。

以下是编写项目宪法（`/speckit.constitution`）的指南和关键原则样例。

---

## 一、项目宪法的目标和创建方式

项目宪法（Constitution）是一个存储在** **`.specify/memory/constitution.md` 文件中的 Markdown 文档，它为整个项目设定了 **不可动摇的规则** 。

### 1. 核心作用

1. **一致性保障：** 确保无论是今天还是明年生成的代码，都遵循相同的原则。
2. **约束 LLM：** 将 LLM 从一个通用的代码生成器转变为一个尊重并强化系统设计原则的 **架构伙伴** 。
3. **指导技术决策：** 宪法中的原则是 AI 代理在规划（`/plan`）和任务分解（`/tasks`）阶段必须遵守的强制性约束。

### 2. 创建和更新命令

您可以通过向 AI 代理提供一个描述性的提示词，让其创建或更新项目宪法。

| 命令                                           | 描述                                                       |
| :--------------------------------------------- | :--------------------------------------------------------- |
| **`/speckit.constitution [原则描述]`** | 创建或更新项目的治理原则和开发指南，指导后续所有开发决策。 |

**示例 Prompt：**

```
/speckit.constitution 创建侧重于整洁和模块化代码、Next.js 15 最佳实践、以及所有新服务 90% 单元测试覆盖率的原则。
```

AI 代理将根据您的提示生成宪法内容，并将其保存在** **`.specify/memory/constitution.md` 文件中。

---

## 二、宪法核心原则及样例

宪法应包含一系列可测试、可执行的规范，特别是关于**代码质量、测试要求和性能目标**的非协商性要求。

### 1. 不可协商的治理原则（架构和流程）

这些原则定义了项目的基本结构和开发流程，旨在防止 **过度工程（Over-engineering）**和**上下文碎片化（Context Fragmentation）** 。

| 宪法原则（Article）                       | 描述                                                                                                                        | 强制要求（MUST/SHOULD）                            | 来源 |
| :---------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------- | :--- |
| **Library-First Principle**         | **库优先原则：** 每个功能（Feature）必须以一个**独立的、可重用**的库（Library）开始，而不是紧密耦合的单体应用。 | 强制模块化设计和清晰的边界。                       |      |
| **CLI Interface Mandate**           | **命令行接口授权：** 每个库必须通过**命令行接口（CLI）**公开其核心功能。                                              | 确保功能可观察、易于调试和验证。                   |      |
| **Simplicity and Anti-Abstraction** | **简洁性与反抽象：** 鼓励简单直接的解决方案。只有当简单方案被证明不足时，才允许增加抽象层和复杂性。                   | **强制** LLM 在规划阶段证明复杂性的合理性。  |      |
| **Architectural Integrity**         | **架构完整性：** 新增功能必须遵循宪法中定义的架构模式（例如，微服务模式 M-3）。                                       | 确保 AI 生成的每个功能都在强化而不是破坏系统设计。 |      |

### 2. 代码质量标准（Code Quality Standards）

代码质量标准确保 AI 代理生成的代码 **易于人类和代理阅读、维护** 。

| 质量标准                         | 描述                                                                                                            | 实施方式                                                                                                              | 来源 |
| :------------------------------- | :-------------------------------------------------------------------------------------------------------------- | :-------------------------------------------------------------------------------------------------------------------- | :--- |
| **Clean and Modular Code** | **整洁和模块化代码：** 强制代码结构清晰，遵循语言或框架的最新最佳实践（例如 Next.js 15 best practices）。 | 在 `/plan` 阶段，AI 代理必须将所有后端逻辑放入指定的 **服务器文件夹** （如 `src/server`），以遵守结构规则。 |      |
| **Explicit Interfaces**    | **显式接口/契约：** 所有组件必须具有明确定义的接口、契约和依赖关系。                                      | 在 `/plan` 阶段生成 API 契约文档（如 `api-spec.json`）和数据模型（`data-model.md`）。                           |      |
| **Canonical Terminology**  | **规范术语：** 避免术语漂移（Terminology Drift）。在规范中对核心概念使用一致的命名。                      | LLM 在 `/clarify` 或 `/analyze` 阶段必须检查和规范化术语。                                                        |      |

### 3. 测试要求（Testing Requirements）

Spec Kit 工作流强烈推荐**测试驱动开发（TDD）**模式，并要求 AI 代理将测试作为**规范的组成部分**来生成。

| 测试要求                            | 描述                                                                                                      | 强制执行方式                                                   | 来源 |
| :---------------------------------- | :-------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------- | :--- |
| **Test-First Imperative**     | **测试先行指令：** **绝不允许**在测试未编写且未能证明其失败（红灯阶段）之前编写任何功能代码。 | `/tasks` 命令将测试任务（TDD）排在核心实现任务之前。         |      |
| **Mandatory Coverage**        | **强制测试覆盖率：** 所有新服务必须达到 **90%的单元测试覆盖率** （或更高）。                  | 在 `/implement` 阶段，AI 代理必须运行测试并验证覆盖率。      |      |
| **Integration-First Testing** | **集成优先测试：** 优先编写反映用户场景的集成测试，而非孤立的单元测试。                             | 任务分解应确保核心用户场景（User Stories）转化为集成测试任务。 |      |

### 4. 性能目标（Performance Goals）

性能目标属于 **非功能性要求** ，必须在规划阶段被遵守。

| 性能目标                       | 描述                                                        | 转化约束样例                                                                                                    | 来源 |
| :----------------------------- | :---------------------------------------------------------- | :-------------------------------------------------------------------------------------------------------------- | :--- |
| **Measurable Latency**   | **可测量的延迟：** 定义关键 API 响应的延迟上限。      | **约束** ： **<200ms p95** （第 95 百分位延迟小于 200 毫秒）。                                      |      |
| **Resource Constraints** | **资源消耗约束：** 定义内存、CPU 或吞吐量的限制。     | **约束** ： **<100MB memory** （内存消耗低于 100MB）或  **1000 req/s** （每秒 1000 个请求）。 |      |
| **Error Handling**       | **错误处理标准：** 定义严格的错误处理和日志记录标准。 | 必须实施统一的错误日志和跟踪机制。                                                                              |      |

---

## 三、项目宪法（Constitution）模板样例

宪法模板（Constitution Template）通常包含核心原则和治理细节。以下是结合上述要求的简化结构样例：

```
##### [PROJECT_NAME] Constitution
# 版本 1.0 | 批准日期：[RATIFICATION_DATE] | 最后修订：[LAST_AMENDED_DATE]

## 核心原则 (Core Principles)

### 原则 I：架构原则 - 库优先 (Library-First Principle)
所有新功能和组件 MUST 以独立的库形式实现，确保模块化和清晰的 API 边界。禁止在未经验证的情况下引入跨库依赖。

### 原则 II：代码质量 - 极简主义 (Simplicity & Anti-Abstraction)
所有代码必须遵循 [技术栈，如 TypeScript/Next.js 15] 的**最新最佳实践**。禁止使用不必要的抽象模式；只有当现有代码模型无法解决特定问题时，才能增加复杂性。

### 原则 III：测试与验证 - 测试先行 (Test-First Imperative)
任何新的功能代码实现之前，MUST 先编写针对该功能的所有**契约测试和集成测试**。AI 代理必须证明这些测试已编写且失败，然后才能开始实现代码。所有新服务代码的**单元测试覆盖率 MUST 达到 90%**。

### 原则 IV：非功能性约束 (Non-Functional Constraints)
所有关键用户交互的 API 响应时间 MUST 满足 **p95 延迟 < 200ms**。在规划阶段，AI 代理必须生成一份研究报告，证明其技术栈和设计决策能够满足此性能目标。

### 原则 V：可观察性与审计 (Observability & Audit)
所有核心业务逻辑和安全事件 MUST 记录日志，并具备**可外部访问的 CLI 或健康检查接口**，以确保可观察性和可审计性。

## 治理 (Governance)

### 修订程序
本宪法只允许通过 MAJOR 或 MINOR 版本更新进行修改。
*   **MAJOR 版本**：移除或重新定义核心架构原则。
*   **MINOR 版本**：新增原则或实质性扩大指南。
宪法修改必须在独立的 Git 分支上进行，并经过至少两名架构师的批准。

**版本**：[CONSTITUTION_VERSION] | **批准日期**：[RATIFICATION_DATE] | **最后修订**：[LAST_AMENDED_DATE]
```


**您可以添加如下原则到您的项目宪法中：**

| **宪法原则（Article）**                        | **描述**                                                                                             | **强制要求 (MUST/SHOULD)**                                  | **来源** |
| ---------------------------------------------------- | ---------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------- | -------------- |
| **I. 模块化设计强制原则 (Modularity Mandate)** | **所有新功能组件 MUST 以独立、可重用模块的形式实现，禁止将核心逻辑代码直接置于项目根目录。**         | **确保所有功能都有清晰的边界（Library-First Principle）**。 |                |
| **II. 关注点分离 (Separation of Concerns)**    | **强制执行清晰的关注点分离。例如，服务器端逻辑、前端组件和测试文件 MUST 位于其指定的隔离文件夹内。** | **防止代码和配置混乱，提高 AI 代理的可读性**。              |                |
