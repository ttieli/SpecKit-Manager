在规范驱动开发（Spec-Driven Development, SDD）工作流中， **规划阶段（Plan Phase）**是至关重要的一步，它将**业务需求（是什么）**转化为**技术蓝图（如何做）** 。

您可以通过使用** **`/speckit.plan` 命令来实现这一阶段。此命令的目的是向 AI 代理（如 Claude Code 或 GitHub Copilot）传达您的技术栈选择、架构约束和性能目标。

## 一、规划阶段（Plan Phase）概述

规划阶段是 SDD 工作流的第四步，紧随“建立项目章程”和“创建/澄清规范”之后。

| 阶段                  | 核心命令          | 目的                                                            | 核心产物                                                          |
| :-------------------- | :---------------- | :-------------------------------------------------------------- | :---------------------------------------------------------------- |
| **规划 (Plan)** | `/speckit.plan` | **定义实现方法** ：确定技术栈、架构、约束和非功能性要求。 | `plan.md`、`data-model.md`、`research.md`、`contracts/`。 |

### 1. 核心作用与转变

1. **从“是什么”到“如何做”：** 在** **`/specify` 阶段，焦点在于用户旅程和业务成果。而在** **`/plan` 阶段，您开始变得 **技术化** ，提供高层次的技术方向。
2. **生成设计工件：** AI 代理不会只生成一个简单的** **`plan.md` 文件。它会根据您的输入，在功能分支目录（例如** **`specs/001-create-taskify/`）中生成一系列实施细节文档，包括数据模型、API 契约和技术研究报告。
3. **遵守宪法：** 规划必须通过“宪法检查（Constitution Check）”，确保架构选择和约束（如测试要求、代码质量）符合项目章程中定义的 **不可协商的原则** 。

### 2. 核心产物文件结构（示例）

在** **`/speckit.plan` 运行完成后，您的功能目录（例如** **`specs/001-create-taskify/`）将包含以下关键文件：

* `plan.md`：详细的实施计划，包含技术上下文、项目结构和设计阶段。
* `research.md`：技术栈决策、原理和替代方案的研究报告。
* `data-model.md`：实体、字段和关系的数据模型（例如 Zod Schema 或 ER 图概述）。
* `quickstart.md`：快速启动指南，捕捉了核心验证场景。
* `contracts/api-spec.json` (或其他格式)：API 契约和接口定义，如 OpenAPI 规范。

---

## 二、`/speckit.plan` 的推荐写法和样例

编写高质量的** **`/plan` 提示词，需要确保涵盖所有技术约束，同时为 AI 代理提供足够的环境上下文。

### 1. 撰写** **`/plan` 提示词的要点

| 撰写要点                   | 描述和作用                                                                                                                              | 来源 |
| :------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------- | :--- |
| **明确技术栈和版本** | 明确指定编程语言、框架和数据库的版本。如果技术栈变动快（如 `.NET Aspire`），需要明确要求 AI 进行研究。                                |      |
| **定义架构约束**     | 明确规定代码结构（例如：将所有后端逻辑放入 `server` 文件夹），使用的架构模式（例如：微服务模式 M-3），以及集成点。                    |      |
| **引入非功能性要求** | 强调性能目标（例如：P95 延迟 < 200ms）、安全标准或资源限制（例如：内存 < 100MB）。这些目标通常在项目宪法中得到强化。                    |      |
| **要求针对性研究**   | 如果对某个依赖库或特定 API 不确定，要求 AI**进行研究** ，并将研究结果纳入 `research.md`。应避免泛泛的研究，而是聚焦于具体问题。 |      |
| **审核避免过度工程** | 在规划完成后，指示 AI 代理审计计划，检查是否有未被要求的、可能导致过度工程的组件，并要求其澄清理由。                                    |      |

### 2. 推荐样例

以下是不同技术栈和项目背景下的** **`/speckit.plan` 提示词示例：

#### 样例 1：现代 Web 应用（Greenfield）

**聚焦：** 选择了流行的现代技术栈，并对 UI 组件和数据库进行了明确约束。

```
/speckit.plan
使用 Next.js 14 应用路由 (App Router)。前端组件库使用 Shad CN UI。数据持久化使用 Neon Serverless Postgres，通过 Drizzle ORM 进行数据访问。
所有 API 交互必须通过 Next.js 的路由处理器 (Route Handlers) 实现。所有服务器端逻辑必须隔离在 ‘src/server’ 文件夹内，以确保清晰的关注点分离。
```

#### 样例 2：企业级后端服务（Brownfield/迭代增强）

**聚焦：** 现有系统的集成、架构模式和严格的性能/安全约束。

```
/speckit.plan
该功能必须使用 Python 3.12 和 FastAPI 框架实现。数据应通过现有项目的 PostgreSQL 数据库进行持久化，使用 SQLAlchemy ORM。
必须严格遵守项目宪法中定义的微服务模式 M-3：新服务必须暴露一个健康检查端点（/health），并且 P95 响应延迟必须低于 100 毫秒。
所有数据验证必须使用 Pydantic 模型，并要求 AI 代理在 contracts/ 目录下生成完整的 OpenAPI 3.0 规范。
```

**解释：** 这个例子将 **技术栈** （Python/FastAPI）与 **宪法要求** （微服务 M-3、P95 延迟）和 **工件生成** （OpenAPI 规范）结合起来，确保了 AI 代理在设计时考虑到了架构约束。

#### 样例 3：最小化前端项目（探索性原型）

**聚焦：** 最小化依赖，利用本地存储，避免复杂的后端设置。

```
/speckit.plan
该应用必须使用 Vite 和最少量的库。尽可能使用原生的 HTML、CSS 和 JavaScript。图片不上传到任何地方，且所有元数据存储在浏览器的本地 SQLite 数据库中。
由于这是一个原型，请勿实现用户身份验证（Authentication）。
```

**解释：** 这种写法明确了对**简洁性**和 **特定技术选择** （本地 SQLite）的追求，这有助于防止 AI 代理引入复杂的第三方库。

### 3. 规划完成后的人工介入（验证）

AI 代理生成计划后，您的角色是**验证**其输出：

1. **审查** **`research.md`：** 检查 AI 代理是否研究了正确的技术栈，特别是对于快速变化的库（如** **`.NET Aspire`）。
2. **审计计划一致性：** 运行提示词（或** **`/speckit.analyze` 命令）来审计计划，确保它没有遗漏关键步骤，并且所有实施细节都可以在相应的文档中找到。
3. **检查过度工程：** 确保 AI 没有擅自添加您未要求的复杂组件，并要求其对任何未被要求的组件提供理由和来源。

只有在这些设计工件（包括** **`plan.md`,** **`data-model.md`,** **`research.md`）经过充分验证后，您才能进入下一个阶段：`/speckit.tasks`（任务分解）。
